---
- name: Install npm
  apt: name=npm state=present

- name: Install forever
  npm: 
    name: forever 
    global: yes

- name: Install git
  apt: name=git state=present

- name: Clone git repository
  git: 
    repo: https://github.com/newsha400/devops-test.git
    dest: /home/newsha400/devops-test

- name: Forever stopall
  command: /usr/local/bin/forever stopall

- name: Forever start 
  command: /usr/local/bin/forever start /home/newsha400/devops-test/index.js




  

# - name: run node in background
#   command: /usr/bin/nohup node /home/newsha400/devops-test/index.js &

# - name: Delete old pm2 process
#   command: pm2 delete /home/newsha400/devops-test/index.js
#   ignore_errors: yes

# - name: Start pm2 process
#   command: pm2 start /home/newsha400/devops-test/index.js

